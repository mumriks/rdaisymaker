# R DAISY Maker の使い方（暫定版）
#
# Copyright (c) 2011, Kishida Atsushi
# qublilabo@gmail.com

１．R DAISY Maker ってなに？

　R DAISY Maker（以降 RDM ）は DAISY 図書（現時点ではテキストデイジー図書限定）を生成するためのプログラムです。主に Windows 環境での使用を想定しています。

　バージョン 0.2.0 からは EPUB3 図書の生成に対応しています。

    ・図書の編集には、エディタやワープロソフトを使用します。
    ・改行までの一行がフレーズとなります。
    ・図の指定（図のタイトル、キャプションなどイメージグループに対応）
    ・表の指定（キャプション、ヘッダに対応）
    ・ルビ（デイジー様式、青空文庫様式、ReVIEW 様式）
    ・注釈番号、注釈の読み飛ばし（スキッパブル）機能
    ・prodnote、annotation、sidebar  （linenum は未実装）
    ・通常ページ、front ページ、special ページ
        （注釈番号、注釈、prodnote、annotation、sidebar、
          通常ページ、frontページ、specialページで読み飛ばし設定が有効）
    ・太字、下線、斜体、傍点
    ・引用符
    ・箇条書きリスト（数字なし、数字つき）、用語リスト
    ・句読点の統一（英文中を除く）


２．使用の準備

　必要なファイル。
        ・Ruby-1.9.x ------------------------- 必須
          (http://www.artonx.org/data/asr/)

        ・RDAISYMaker ------------------------ 必須
          (https://github.com/mumriks/rdaisymaker)

        ・image_size ライブラリ -------------- 必須
         （http://rubyforge.org/frs/?group_id=3460）

        ・uuid ライブラリ -------------------- 必須
          (https://github.com/shyouhei/ruby-uuid)

        ・rubyzip ライブラリ ----------------- EPUB3(DAISY4)で必須
          (http://github.com/aussiegeek/rubyzip)

        ・MeCab ------------------------------ ルビ振りするなら必須
        ・MeCab-Ruby バインディング ---------- 　　　　同上
          (http://mecab.googlecode.com/svn/trunk/mecab/doc/index.html)

        ・epubcheck -------------------------- EPUB3 では望ましい
          (http://code.google.com/p/epubcheck/)


　RDM を使用するには Ruby が必要になります。先に Ruby をインストールしてください。

　rdm フォルダを任意の場所に置いたら、フォルダの中にある win_setup.bat をダブルクリックします。フォルダ内に rdmconsole.bat が生成されます。

　もしも、rdm フォルダを別の場所に移動した場合には、再度 win_setup.bat を実行し、生成された rdmconsole.bat を使用するようにしてください。

　編集ツールの pedit.rb でルビ振り機能を使う際には、形態素解析エンジンの MeCab （めかぶ）も必要になりますが、ルビ振りを使わなければ必要ありません。

　画像サイズの処理に image_size のインストールが必要です。（http://rubyforge.org/frs/?group_id=3460）　image_size.rb を /lib 以下に置きます。

　uuid.rb も /lib 以下に置きます。ただし Windows では File.open 部分の "w" と "r+" 部分を、それぞれ "wb" と "r+b" に修正する必要があります。

　rubyzip はすべての zip フォルダを、/lib 以下に置いてください。

　epubcheck プログラムは、/lib/rdm/epubcheck 以下に置いてください。

３．生成の準備

　作業用の任意のフォルダを用意し、図書の原稿テキストファイルをその中に全て置きます。準備で生成した rdmconsole.bat もコピーします。

　原稿テキストファイルはすべて utf-8 で保存してください。また、ファイル名に日本語は使用しないようにしてください。

　使用する画像ファイルもすべて作業用フォルダの中に置きます。画像ファイル名にも日本語は使用しないようにしてください。

　原稿テキストファイルの並び順を SECTIONS ファイルに書き込みます。このファイルに関しては、列挙する原稿ファイルに日本語が使われていないので Shift-JIS のままでも問題ありません。

    file1.txt
    file2.txt

　のように一行にひとつのファイル名をページ順に列挙してください。

　sample.yaml ファイルを開き、書名や著者名など必要な情報を書き換え、ファイル名も生成する図書にあわせた名前に適宜変更してください。このファイルも utf-8 で保存してください。ファイル名は半角英数を使用してください。


４．テキストデイジー図書を作成する

　準備が整ったら、作業フォルダにおいた rdmconsole.bat をダブルクリックします。

　コマンドラインコンソールが起動するので、「 rdm 」と入力し、リターンします。問題がなければ作業フォルダの中に .yaml ファイルのベースネーム（先の例では sample ）をつけたフォルダを作成し、その中に図書データを生成します。

　万一記法などに不備があった場合には、コンソールにエラーメッセージが表示されます。該当するファイル名と行数、タグ名などが表示されるので、それを参考に修正したうえで、再度「 rdm 」を実行してください。

　なお、エラーの発生した行数はおよそのものであり、数行程度の誤差が生じることがあります。


５．デイジーバリデーション

　RDM 自体ではバリデーション機能を持っていません。デイジーコンソーシアムのサイトから Pipeline ( GUI 版）をダウンロードし使用してください。


６．ライセンスについて

　RDM は２条項 BSD ライセンスで公開します。

